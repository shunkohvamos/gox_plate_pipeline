# Codex 用プロンプト：目的関数の設計

以下の指示に従い、**このプロジェクトの目的関数（FoG と U0 を組み合わせたスコア）の設計**を提案してください。

---

## 1. 必ず読むファイル（入力）

次の2つを**先に読んで**から設計に進んでください。

- **`research strategy/Objective_strategy/リサーチ結果.md`**  
  - 恣意性の突っ込み、主解析の最小仕様（二軸＋等スコア線・直線スコア）、タイブレーク、論文記載テンプレ、制約付きBOの分離の要点がまとまっている。
- **`research strategy/Objective_strategy/実装と解析手法.txt`**  
  - 酵素工学論文20件の目的関数設計（加重和・閾値・Pareto等）、制約付きBOの扱い、「後付けに見えない」Methods/Results/Supplementary のテンプレート、参考文献リスト。

上記の「調査で分かったこと」と「推奨方針」を踏まえた上で、下のタスクを実行してください。

---

## 2. やってほしいこと（タスク）

### A) 目的関数の候補設計（2〜3案）

- **入力データ**: 本プロジェクトでは  
  - **FoG** = t50_polymer / t50_GOx（同一 run/plate の GOx 基準）、  
  - **U0** = heat=0 の絶対活性を GOx 基準で正規化した値（native_activity_rel_at_0）  
  が既に計算されている（`fog_summary` 等）。
- **要求**:
  1. リサーチ結果で推奨されている「**連続スコア（直線の等スコア線）**」を主軸に、FoG と U0（または log(U0)）を組み合わせた **スコア式を 2〜3 案** 提案する。
  2. 各案について  
     - 数式（例: score = w_s·FoG + w_a·log(U0) など）、  
     - 直感的な意味（何を高く評価するか）、  
     - 重みや閾値の「事前に固定する部分」と「感度分析で振る部分」の区別  
    を明記する。
  3. **PMTAC のような「低 U0・高 FoG」の候補**をどう扱うか（タイブレークや補助ルール）を、リサーチ結果の「knee point / hypervolume / 閾値感度」を参照して 1 行で固定する案を入れる。

### B) 論文記載用の文言（Methods 1 パラグラフ）

- リサーチ結果の「論文記載テンプレ」を参照し、**採用するスコア案**について、  
  - Primary endpoints（U0, FoG の定義）、  
  - Primary analysis（連続スコアの式と事前重み）、  
  - Decision rule（ランキングとタイブレーク）、  
  - 実験的 infeasibility の扱い（目的と分離）  
  を 1 パラグラフにまとめた **英語の Methods 文** を書く。  
  [ ] の部分は具体的な数値や理由に置き換えてよい。

### C) 感度分析の項目リスト

- リサーチ結果・実装と解析手法の「感度分析」「後付け疑いを潰す」を踏まえ、  
  - 重み（w_a/w_s）を変えたときの top-k の安定性、  
  - U0 閾値（0.7, 0.8, 0.9）を補助解析で振ったときのランク相関（Kendall τ）、  
  - その他、本プロジェクトで実施すべき感度分析を **箇条書きで 3〜5 項目** 挙げる。

### D) 実装・データとの対応

- 現在のコードでは `log_fog_native_constrained`（U0 ≥ 0.7 のときだけ FoG を採用）が BO の目的になっている。  
  提案したスコアを **主解析** に据える場合、  
  - 既存のどの列（fog_summary / primary_objective_table 等）を入力に使うか、  
  - 新規に計算する列名と式をどうするか  
  を 1〜2 文で述べる。コード変更は具体的なパッチではなく「方針」レベルでよい。

---

## 3. 出力形式

- **Markdown** で、見出しを  
  `## A) 目的関数候補` / `## B) Methods 文` / `## C) 感度分析` / `## D) 実装対応`  
  に揃えて出力する。
- 数式は LaTeX 記法（例: `$S = w_s \cdot \mathrm{FoG} + w_a \cdot \log(U_0)$`）で書く。
- リサーチ結果・実装と解析手法の**どの記述を根拠にしたか**（例: 「リサーチ結果の“直線スコア”」「実装と解析手法の閾値事前定義」）を、該当する案の直下に短く書く。

---

## 4. 制約（守ること）

- 目的関数と**実験的制約（測定失敗・QC 除外・検出限界）は分離して扱う**（制約付きBOの流儀に合わせる）。
- **閾値（U0 ≥ 0.7 など）は主解析の式に埋め込まず**、補助解析・感度分析で扱うと明記する。
- 重みや閾値は「事前に固定する値」と「感度分析で振る値」をはっきり区別する。

---

以上を満たす目的関数設計案を出力してください。まず `リサーチ結果.md` と `実装と解析手法.txt` を読んだ上で、A)→B)→C)→D) の順で回答してください。
